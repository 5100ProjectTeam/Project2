<!DOCTYPE html>
<html lang="en">
    <head>
    <title>INFO 5100: Project 2</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" href="bootstrap.min.css"><!-- Minified CSS -->
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
        <script src="js/bootstrap.min.js"></script>
    </head>
    <body>

    <div id="visualization1">
    	<h1 class="viz1header">FIFA WORLD CUP TEAMS OVER THE YEARS (1960 - 2014) </h1>
         <p class="introduction">
        </p>
        <h4 class="bigger_note">(Click on each of the flags to find out more)</h4>
        <h4 class="note"> * Number of wins are calculated post 1960 due to non-availability of certain data needed for further analysis, before 1960 </h4>

    	<div id="flags_wrapper">
            <div id="flags_column_one">   
	             <div id="germany"></div>
	             <div id="argentina"></div>
	             <div id="italy"></div>
            </div>
             <div id="flags_column_two">
                 <div id="brazil"></div>   
             </div>
             <div id="flags_column_three">
	             <div id="france"></div>
	             <div id="england"></div>
	             <div id="spain"></div>      
             </div>
         </div>
    </div> 
    <div id="visualization2">
        <h1> Does the GPD affect team's performance? </h1>
        <h4 class="bigger_note"> (Click on the checkboxes below to plot the graphs) </h4>
        <h4 class="note"> * GDP starts post 1960 due to non-availability of data before 1960. Also data N/A for the years 1960 and 1964 (Germany) </h4>
         <div id="text_gdp">
        <p>
            
        </p>
        </div>
         <div id="checkboxes">
         <label> <input type="checkbox"  id="Germany_button" value="Germany"/> Germany </label>
         <label> <input type="checkbox"  id="Argentina_button"  value="Argentina"/> Argentina </label>
         <label> <input type="checkbox"  id="Italy_button"  value="Italy"/> Italy </label>
         <label> <input type="checkbox"  id="Brazil_button"  value="Brazil"/> Brazil </label>
         <label> <input type="checkbox"  id="France_button"  value="France"/> France </label>
         <label> <input type="checkbox"  id="England_button"  value="England"/> England </label>
         <label> <input type="checkbox"  id="Spain_button" value="Spain"/> Spain </label>
         </div>
    </div>

      <h1 class="title_star">Number of Star Players in Each Team</h1>
      <h4 class="bigger_note">(Hover over the circles to see Who!)</h4>
      <div id="plot2"></div>
      <div id="player"></div>
      <h1> Conceptual Representation of Football Culture </h1> 
	     <h4 class="bigger_note">(Click on each segment in the Pie Chart to find out more)</h4>
      <div id="text_culture">
        <p>
            Football culture is analyzed through three indexes: percentage of registered and unregistered players among the general population; percentage of the total stadium capacity as measured against the total population of the country; percentage of U20 World Cups won by each country against the total number of U20 Cups. The data come from <a href="http://www.fifa.com/worldfootball/bigcount/index.html" class="italics">FIFAâ€™s 2006 Big Count report.</a>
            
            It seems all the seven countries have roughly similar percentage of football players, apps. 7%, with the exception of Germany 19.8%. Stadium capacty per capita fall within a narrow range amount these seven countries. On the other hand, Brazil and Argentina seem to have reaped a significant portion of U20 winners. 
        </p>
    </div>

    <div id="pieChart"></div>
    <div id="barChart"></div>  
    
    <h1 class="conclusion"> Conclusion </h1>
        <p class="conclusion">
        </p>
   
        <script type="text/javascript">

/* ------------------------------------------- VISUALIZATION 1 ----------------------------------------------- */

     var svg1 = d3.select("#germany").append("svg")
    .attr("width", 500)
    .attr("height",200);


     var svg2 = d3.select("#argentina").append("svg")
    .attr("width", 500)
    .attr("height",200);


     var svg3 = d3.select("#italy").append("svg")
    .attr("width", 500)
    .attr("height",200);


    var svg4 = d3.select("#brazil").append("svg")
    .attr("width", 300)
    .attr("height",500);

     var svg5 = d3.select("#france").append("svg")
    .attr("width", 500)
    .attr("height",200);

     var svg6 = d3.select("#england").append("svg")
    .attr("width", 500)
    .attr("height",200);

    var svg7 = d3.select("#spain").append("svg")
    .attr("width", 500)
    .attr("height",200);

    $(document).ready(function(){

   /* Germany */

    svg1.append('svg:image')
    .attr('xlink:href', 'images/germany.png')
    .attr("class","germanypic")
    .attr("width", 170)
    .attr("height", 170)
    .attr("x", 90)
    .attr("y", 0);
    
 	svg1.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","germany1")
    .attr("width", 40)
    .attr("height", 60)
    .attr("transform","translate(45,25)")
    .transition()
    .duration(500)
    .attr("transform","translate(45,25), rotate(-50)")
    .ease("linear");

    svg1.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","germany2")
    .attr("width", 40)
    .attr("height", 70)
		.attr("transform","translate(45,15), rotate(-50)")
    .transition()
    .duration(500)
    .attr("transform","translate(30,110), rotate(-90)")
    .ease("linear");

     svg1.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","germany3")
    .attr("width", 40)
    .attr("height", 70)
		.attr("transform","translate(45,15), rotate(-50)")
    .transition()
    .duration(500)
    .attr("transform","translate(72,190), rotate(-130)")
    .ease("linear");

    svg1.append("text")
    .attr("class","germanytext")
    .text("GERMANY")
    .style("font-weight","bold")
    .attr("transform","translate(360,50)");

    svg1.append("text")
    .attr("class","germanytext")
    .text("Years Won:")
    .attr("transform","translate(360,70)");

    svg1.append("text")
    .attr("class","germanytext")
    .text("1974: Germany 2-1 Netherlands")
    .attr("transform","translate(360,90)");

    svg1.append("text")
    .attr("class","germanytext")
    .text("1990: Germany 1-0 Argentina")
    .attr("transform","translate(360,110)");

    svg1.append("text")
    .attr("class","germanytext")
    .text("2014: Germany 1-0 Argentina")
    .attr("transform","translate(360,130)");

    $(".germanypic").click(function(){
         $(".germanytext").show(1000);
     }); 


    /* Argentina */

     svg2.append('svg:image')
    .attr('xlink:href', 'images/argentina.png')
    .attr("class","argentinapic")
    .attr("width", 170)
    .attr("height", 170)
    .attr("x", 90)
    .attr("y", 0);
    
 	svg2.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","argentina1")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(40,45)")
    .transition()
    .duration(500)
    .attr("transform","translate(40,45), rotate(-50)")
    .ease("linear");
 
     svg2.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","argentina2")
    .attr("width", 40)
    .attr("height", 70)
	.attr("transform","translate(40, 45), rotate(-50)")
    .transition()
    .duration(500)
    .attr("transform","translate(60,160), rotate(-120)")
    .ease("linear");
   
     svg2.append("text")
    .text("ARGENTINA")
    .style("font-weight","bold")
    .attr("class","argentinatext")
    .attr("transform","translate(350,50)");

	svg2.append("text")
    .text("Years Won:")
    .attr("class","argentinatext")
    .attr("transform","translate(350,70)");

    svg2.append("text")
    .text("1978: Argentina 3-1 Netherlands")
    .attr("class","argentinatext")
    .attr("transform","translate(350,90)");

     svg2.append("text")
    .text("1986: Argentina 3-2 Germany")
    .attr("class","argentinatext")
    .attr("transform","translate(350,110)");

      $(".argentinapic").click(function(){
          $(".argentinatext").show(1000);
        }); 



    /* Italy*/

     svg3.append('svg:image')
    .attr('xlink:href', 'images/italy.png')
    .attr("class","italypic")
    .attr("width", 170)
    .attr("height", 170)
    .attr("x", 90)
    .attr("y", 0);
   
 	svg3.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","italy1")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(40,45)")
    .transition()
    .duration(500)
    .attr("transform","translate(40,45), rotate(-50)")
    .ease("linear");

     svg3.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","italy2")
    .attr("width", 40)
    .attr("height", 70)
	.attr("transform","translate(40, 45), rotate(-50)")
    .transition()
    .duration(500)
    .attr("transform","translate(60,160), rotate(-120)")
    .ease("linear");

     svg3.append("text")
    .text("ITALY")
    .style("font-weight","bold")
    .attr("class","italytext")
    .attr("transform","translate(350,50)");

	svg3.append("text")
    .text("Years Won:")
    .attr("class","italytext")
    .attr("transform","translate(350,70)");

    svg3.append("text")
    .text("1982: Italy 3-1 Germany")
    .attr("class","italytext")
    .attr("transform","translate(350,90)");

     svg3.append("text")
    .text("2006: Italy 1-1 (5-3p) France")
    .attr("class","italytext")
    .attr("transform","translate(350,110)");     

    $(".italypic").click(function(){
         $(".italytext").show(1000);
    }); 

    /* Brazil */

     svg4.append('svg:image')
    .attr('xlink:href', 'images/brazil.png')
    .attr("class","brazilpic")
    .attr("width", 170)
    .attr("height", 170)
    .attr("x", 65)
    .attr("y", 100);
  
	 	svg4.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","brazil1")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(50,80), rotate(-40)");
    
     svg4.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","brazil2")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(50, 80), rotate(-40)")
    .transition()
    .duration(500)
    .attr("transform","translate(108,45), rotate(-10)")
    .ease("linear");
  
     svg4.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","brazil3")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(50,80), rotate(-40)")
    .transition()
    .duration(500)
    .attr("transform","translate(175,40), rotate(20)")
    .ease("linear");

     svg4.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","brazil4")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(50,75), rotate(-40)")
    .transition()
    .duration(500)
    .attr("transform","translate(235,60), rotate(50)")
    .ease("linear");

   	 svg4.append("text")
    .text("BRAZIL")
    .style("font-weight","bold")
    .attr("class","braziltext")
    .attr("transform","translate(150,280)");

	svg4.append("text")
    .text("Years Won:")
    .attr("class","braziltext")
    .attr("transform","translate(150,300)");

    svg4.append("text")
    .text("1962: Brazil 3-1 Czechoslovakia")
    .attr("class","braziltext")
    .attr("transform","translate(150,320)");

	svg4.append("text")
    .text("1970: Brazil 4-1 Italy")
    .attr("class","braziltext")
    .attr("transform","translate(150,340)");
    
     svg4.append("text")
    .text("1994: Brazil 3-2 Italy")
    .attr("class","braziltext")
    .attr("transform","translate(150,360)");
    
     svg4.append("text")
    .text("2002: Brazil 2-0 Germany")
    .attr("class","braziltext")
    .attr("transform","translate(150,380)");
   

    $(".brazilpic").click(function(){
          $(".braziltext").show(1000);
    }); 
    /* France */

      svg5.append('svg:image')
    .attr('xlink:href', 'images/france.png')
    .attr("class","francepic")
    .attr("width", 170)
    .attr("height", 170)
    .attr("x", 250)
    .attr("y", 0);
  
 	svg5.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","france1")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(375,0)")
    .transition()
    .duration(500)
    .attr("transform","translate(435,0), rotate(45)")
    .ease("linear");       

     svg5.append("text")
    .text("FRANCE")
    .style("font-weight","bold")
    .attr("class","francetext")
    .attr("transform","translate(180,50)");
   
	svg5.append("text")
    .text("Years Won:")
    .attr("class","francetext")
    .attr("transform","translate(180,70)");
    

     svg5.append("text")
    .text("1998: France 3-0 Brazil")
    .attr("class","francetext")
    .attr("transform","translate(180,90)");
    
    $(".francepic").click(function(){
        $(".francetext").show(1000);
    }); 

		/* England */

		  svg6.append('svg:image')
    .attr('xlink:href', 'images/england.png')
    .attr("class","englandpic")
    .attr("width", 170)
    .attr("height", 170)
    .attr("x", 250)
    .attr("y", 0);
  
 	svg6.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","england1")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(375,0)")
    .transition()
    .duration(500)
    .attr("transform","translate(435,0), rotate(45)")
    .ease("linear"); 

     svg6.append("text")
    .text("ENGLAND")
    .style("font-weight","bold")
    .attr("class","englandtext")
    .attr("transform","translate(180,50)");

	svg6.append("text")
    .text("Years Won:")
    .attr("class","englandtext")
    .attr("transform","translate(180,70)");

     svg6.append("text")
    .text("1966: England 4-2 Germany")
    .attr("class","englandtext")
    .attr("transform","translate(180,90)");

    $(".englandpic").click(function(){
       $(".englandtext").show(1000);
    }); 


    /* Spain */

      svg7.append('svg:image')
    .attr('xlink:href', 'images/spain.png')
    .attr("class","spainpic")
    .attr("width", 170)
    .attr("height", 170)
    .attr("x", 250)
    .attr("y", 0);
   
 	svg7.append('svg:image')
    .attr('xlink:href', 'images/trophy.png')
    .attr("class","spain1")
    .attr("width", 40)
    .attr("height", 70)
    .attr("transform","translate(380,0)")
    .transition()
    .duration(500)
    .attr("transform","translate(440,0), rotate(45)")
    .ease("linear"); 

     svg7.append("text")
    .text("SPAIN")
    .style("font-weight","bold")
    .attr("class","spaintext")
    .attr("transform","translate(170,50)");
  
	svg7.append("text")
    .text("Years Won:")
    .attr("class","spaintext")
    .attr("transform","translate(170,70)");

     svg7.append("text")
    .text("2010: Spain 1-0 Netherlands")
    .attr("class","spaintext")
    .attr("transform","translate(170,90)");

    $(".spainpic").click(function(){
        $(".spaintext").show(1000);
      }); 
});


        /* ------------------------------------------- VISUALIZATION 2 ------------------------------------- */


    var margin = {top: 20, right: 80, bottom: 30, left: 150};
    var width = 800 - margin.left - margin.right
    var height = 500 - margin.top - margin.bottom;
    var type = [];


    var xScale = d3.scale.linear()
           .range([0, width]);

    var yScale = d3.scale.linear()
           .range([height, 0]);

      
    var color = d3.scale.ordinal()
                  .domain(["Germany", "Argentina", "Italy", "Brazil","France","England","Spain"])
                  .range(["#E7BA52", "#9ECAE1" , "#D62728","#74C476","#FD8D3C","#843C39","#393B79"]);
    
    var formatNumber = d3.format(".2f"),
    formatTrillion = function(x) { return formatNumber(x / 1e12) + " T"; };
    formatBillion = function(x) { return formatNumber(x / 1e9) + " B"; },
    formatMillion = function(x) { return formatNumber(x / 1e6) + " M"; },
    formatThousand = function(x) { return formatNumber(x / 1e3) + " k"; };

    function formatAbbreviation(x) {
      var v = Math.abs(x);
      return (v >= .9995e12 ? formatTrillion
              : v >= .9995e9 ? formatBillion
              : v >= .9995e6 ? formatMillion
              : formatThousand)(x);
    }


    var xAxis = d3.svg.axis()
        .scale(xScale)
        .orient("bottom")
        .tickFormat(d3.format("d"))
        .innerTickSize(-height)
        .outerTickSize(0)
        .tickPadding(10)
        .tickValues([1962, 1966, 1970, 1974, 1978, 1982, 1986, 1990, 1994, 1998, 2002, 2006, 2010, 2014]);

    var yAxis = d3.svg.axis()
        .scale(yScale)
        .orient("left")
        .innerTickSize(-width)
        .outerTickSize(0)
        .tickPadding(10)
        .ticks(10)
        .tickFormat(function(d) { return formatAbbreviation(d).replace('B', ' Billion').replace('T',' Trillion'); });

    var line = d3.svg.line()
        .x(function(d) { return xScale(d.year); })
        .y(function(d) { return yScale(d.gdp); });

    var svg8 = d3.select("#visualization2").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


    d3.csv("GDP.csv", function(error, data) 
    {
              var countries = color.domain().map(function(name) {
                return {
                          name: name,
                          values: data.map(function(d) 
                                {
                                return {year: d.year, gdp: +d[name] , year_won : d.year_won };
                                })
                         };
              }); 

            xScale.domain([1962, 2018]);
            yScale.domain([
                d3.min(countries, function(c) { return d3.min(c.values, function(v) { return v.gdp; }); }),
                d3.max(countries, function(c) { return d3.max(c.values, function(v) { return v.gdp; }); })
              ]);

            svg8.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height + ")")
              .call(xAxis);

            svg8.append("g")
              .attr("class", "y axis")
              .call(yAxis)
              .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", ".71em")
              .style("text-anchor", "end")
              .text("GDP ($)");
          
            var country = svg8.selectAll(".country")
              .data(countries)
              .enter().append("g")
              .attr("class", "country");

             d3.selectAll("input[type=checkbox]").on("change", function()
             {
                type = this.value;
                 if (this.checked == true)
                {
                     var path = country.append("path")
                     .attr("class", "line")
                     .filter(function(d){return d.name===type;})
                     .attr("d", function(d) { return line(d.values); })
                     .style("stroke", function(d) { return color(d.name); });
                     
                     var totalLength = path.node().getTotalLength();
                  
                     path.attr("stroke-dasharray", totalLength + " " + totalLength)
                     .attr("stroke-dashoffset", totalLength)
                     .attr("id", type)
                     .transition()
                     .duration(1000) 
                     .ease("linear") 
                     .attr("stroke-dashoffset", 0); 

                     country.append("text")
                     .filter(function(d){return d.name===type;})
                     .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
                     .attr("transform", function(d) { return "translate(" + xScale(d.value.year) + "," + yScale(d.value.gdp) + ")"; })
                     .attr("x", 3)
                     .attr("id", type)
                     .attr("dy", ".35em")
                     .style("font-size","0.9em")
                     .text(function(d) { return d.name; });

                     var circle;

                        for (var k = 0; k <14; k++) 
                        {
                           circle = country.append("circle")
                          .filter(function(d){return d.name===type;})
                          .datum(function(d){ return d.values; })
                          .attr("class", "circle")
                          .transition()
                          .delay(k*75)
                          .attr("id",type)
                          .attr("r",3)
                          .attr("cx", function(d){ return xScale(d[k].year);})     
                          .attr("cy", function(d){ return yScale(d[k].gdp);})
                          .style("stroke","black")
                          .style("fill","none");
                         }
                       
                          for (var l = 0; l <14; l++) 
                         {
                           country.append('svg:image')
                          .filter(function(d){return d.name===type;})
                           .datum(function(d){ return d.values; })
                           .attr('xlink:href','images/trophy.png')
                           .attr("id",type)
                           .transition()
                           .delay(l*75)
                           .attr("width",30)
                           .attr("height",30)
                           .attr('x',function(d)
                            {
                                 if(d[l].year_won == type)
                                 return xScale(d[l].year) + -15;
                                 else return -999999;
                                 
                            })
                           .attr('y',function(d){
                                if(d[l].year_won == type)
                                return yScale(d[l].gdp) + -15;
                            else return -999999;

                           })
                           .attr("dx","1em")
                           .attr("dy","1em");
                           }

                        for (var k = 0; k <14; k++) 
                         {
                           circle = country.append("circle")
                          .filter(function(d){return d.name===type;})
                          .datum(function(d){ return d.values; })
                          .attr("class", "tooltip")
                          .attr("r",10)
                          .attr("cx", function(d){ return xScale(d[k].year);})     
                          .attr("cy", function(d){ return yScale(d[k].gdp);})
                          .attr("title", function(d){ return "$" + formatAbbreviation(d[k].gdp); } )
                          .style("stroke","black")
                          .style("opacity",0)
                          .style("fill","red");
                         }
                 }
                else {
                    country.selectAll("#" + type).remove(); 
                     country.selectAll(".tooltip").remove(); 
                 }
           $(".tooltip").attr("data-toggle", "tooltip"); // adding data-toggle attr to each circle
                $('[data-toggle="tooltip"]').tooltip({// select the all element with data-toggle = "tooltip" to create tooltip
                    'container': 'body',
                    'placement': 'top'
                });
        }); 

});

/* ---------------------------------------------- VISUALIZATION 3 --------------------------------------------- */
/* ----------------------------------------------                 --------------------------------------------- */
/* ----------------------------------------------                 --------------------------------------------- */
/* ------------------------------------------------------------------------------------------------------------ */

    var svg_height = 700;
    var svg_width = 1300;
    var svg_padding = 50;
    var paddingtop = 100; // between country flags and x axis line;
    var label_padding = 25; //between axis labels and axis line

    var xScale1;
    var yScale1;

    var players;

    var playerinfo;

    var teams;
    var years;
    var uniqueTeams;
    var uniqueYears;

    var firstappear,secondappear,thirdappear,fourthappear,fifthappear;

    var blocksBrazil = [];
    var blocksGermany = [];
    var blocksItaly = [];
    var blocksSpain = [];
    var blocksArgentina = [];
    var blocksFrance = [];
    var blocksEngland = [];

    var circles;
    var b;

    var svg = d3.select("#plot2").append("svg")
    .attr("height", svg_height)
    .attr("width", svg_width+30)
    .attr("class","graph2svg");


    d3.csv("player_ranking.csv", function (error, data) 
    {
        players = data;
        firstappear = players.map(function (player) 
        {
        // Create shorter variable names
            return {
                x: player["national_teams"],
                y: player["1st_world_cup_appearance"],
                label: player["player "]
            };
        })
    
        .filter(function (point) {
        // we only consider the records after 1960
        return !(point.x == "") && !(point.y == "") && (Number(point.y) >1960);
        });

        secondappear = players.map(function (player) 
        {
        // Create shorter variable names
            return {
                x: player["national_teams"],
                y: player["2ed_world_cup_appearance"],
                label: player["player "]
            };
        })
        
        .filter(function (point) {
        // Some countries are missing one or more data fields,
        //  so silently drop them. Sorry Belgium!
        return !(point.x == "") && !(point.y == "") && (Number(point.y) >1960);
        });

         thirdappear = players.map(function (player) 
         {
        // Create shorter variable names
            return {
                x: player["national_teams"],
                y: player["3rd_world_cup_appearance"],
                label: player["player "]
             };
         })

    .filter(function (point) {
        // Some countries are missing one or more data fields,
        //  so silently drop them. Sorry Belgium!
        return !(point.x == "") && !(point.y == "") && (Number(point.y) >1960);
    });

    fourthappear = players.map(function (player) 
    {    
         return {
            x: player["national_teams"],
            y: player["4th_world_cup_appearance"],
            label: player["player "]
        };
    })
    .filter(function (point) {
        // Some countries are missing one or more data fields,
        //  so silently drop them. 
        return !(point.x == "") && !(point.y == "") && (Number(point.y) >1960);
    });

    fifthappear = players.map(function (player) 
    {
        // Create shorter variable names
        return {
            x: player["national_teams"],
            y: player["5th_world_cup_appearance"],
            label: player["player "]
        };
    })

    .filter(function (point) {
        // Some countries are missing one or more data fields,
        //  so silently drop them. Sorry Belgium!
        return !(point.x == "") && !(point.y == "") && (Number(point.y) >1960);
    });
    //combine all the players' information into one array
    playerinfo = firstappear.concat(secondappear).concat(thirdappear).concat(fourthappear).concat(fifthappear);
   
    teams = playerinfo.map(function (player){
        return player.x;
    });

    //removeing duplicate elements in teams
    uniqueTeams = teams.filter(function(elem, pos) {
    return teams.indexOf(elem) == pos;
     }); 

    years = playerinfo.map(function (point) {
        return point.y;
    }).sort();

    uniqueYears = years.filter(function(elem, pos) {
    return years.indexOf(elem) == pos;
     }); 

    // building group for each block of points e.g.
    var coordinates = playerinfo.map(function (player){
        return [player.x, player.y];
    });

    //remove duplicates
    for(var i = 0; i < coordinates.length; i++) {
        for(var j = i + 1; j < coordinates.length; ) {
            if(coordinates[i][0] == coordinates[j][0] && coordinates[i][1] == coordinates[j][1])
                // Found the same. Remove it.
                coordinates.splice(j, 1);
            else
                // No match. Go ahead.
                j++;
        }    
    }

    var playersBrazil = [];
    var playersGermany = [];
    var playersItaly = [];
    var playersSpain = [];
    var playersArgentina = [];
    var playersEngland = [];
    var playersFrance = [];

    playerinfo.forEach(function (player) {
        for(var i = 0; i<uniqueYears.length; i++){
            if ((player.y == uniqueYears[i]) && (player.x == "Brazil" )){
                playersBrazil.push(player);
            }
            if ((player.y == uniqueYears[i]) && (player.x == "Germany" )){
                playersGermany.push(player);                
            }
            if ((player.y == uniqueYears[i]) && (player.x == "Italy" )){
                playersItaly.push(player);
            }
            if ((player.y == uniqueYears[i]) && (player.x == "Spain" )){
                playersSpain.push(player);               
            }
            if ((player.y == uniqueYears[i]) && (player.x == "Argentina" )){
                playersArgentina.push(player);               
            }
            if ((player.y == uniqueYears[i]) && (player.x == "England" )){
                playersEngland.push(player);               
            }
            if ((player.y == uniqueYears[i]) && (player.x == "France" )){
                playersFrance.push(player);
            }
        }; 
    });

    uniqueYears.forEach(function (year){
        var array1=[];
        var array2=[];
        var array3=[];
        var array4=[];
        var array5=[];
        var array6=[];
        var array7=[];
        playersBrazil.forEach( function (player) {
            if (Number(player.y) == year){
                array1.push(player); 
            }
        });
        blocksBrazil.push(array1);

        playersGermany.forEach( function (player) {
            if (Number(player.y) == year){
                array2.push(player); 
            }
        });
        blocksGermany.push(array2);

        playersItaly.forEach( function (player) {
            if (Number(player.y) == year){
                array3.push(player); 
            }
        });
        blocksItaly.push(array3);

        playersSpain.forEach( function (player) {
            if (Number(player.y) == year){
                array4.push(player); 
            }
        });
        blocksSpain.push(array4);

        playersArgentina.forEach( function (player) {
            if (Number(player.y) == year){
                array5.push(player); 
            }
        });
        blocksArgentina.push(array5);

        playersFrance.forEach( function (player) {
            if (Number(player.y) == year){
                array6.push(player); 
            }
        });
        blocksFrance.push(array6);

        playersEngland.forEach( function (player) {
            if (Number(player.y) == year){
                array7.push(player); 
            }
        });
        blocksEngland.push(array7);
        
    });
    
    //X and Y Scales: 
    xScale1 = d3.scale.ordinal()
    .domain(uniqueTeams).rangeBands([svg_padding,svg_width-svg_padding], 0.28);

    yScale1 = d3.scale.ordinal()
    .domain(years).rangeRoundBands([svg_height - svg_padding, paddingtop],0.3);

    var xAxis1 = d3.svg.axis().scale(xScale1).orient("top");
    var yAxis1 = d3.svg.axis().scale(yScale1).orient("left").ticks(13);
            
    svg.append("g")
    .attr("transform", "translate(0," + (paddingtop) + ")")
    .attr("class", "Xaxis")
    .call(xAxis1);

    svg.append("g")
    .attr("transform", "translate(" + svg_padding + ",0)")
    .attr("class", "Yaxis")
    .call(yAxis1);

    var tip = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-10, 0])
    .html(function(d) {
       return "<strong>Name</strong> <span style='color:red'>" + d.label + "</span>";
    });


    var color = d3.scale.ordinal()
                  .range(["#9ecae1", "#74c476", "#d62728","#393b79","#e7ba52","#fd8d3c","#843c39"]);

    var imgsLinks = ["images/argentinian-flag-large.png","images/1280px-Flag_of_Brazil.svg.png","images/english-flag-graphic.png","images/french-flag-large.png","images/german-flag-large.png","images/italian-flag-medium.png","images/Flag_of_Spain.svg.png"];

    createCircles(blocksArgentina);
    createCircles(blocksBrazil);
    createCircles(blocksItaly);
    createCircles(blocksSpain);
    createCircles(blocksGermany);
    createCircles(blocksFrance);
    createCircles(blocksEngland);

    function createCircles(blocks){
        b = blocks  // an array of array of points

        // filter arrays that does not contrain any points
        var new_b = b.filter(function (arr) {
            return !(arr.length == 0);
        })
        
        new_b.forEach( function (p)// p is an array of players who appeared in the same year for the
        {   
             i = 0
             while (i<p.length)
             {
                svg.append("circle")
                .data(p)
                .attr("class", p[i].label)
                .attr("title", p[i].label)
                .attr("class","tooltip")
                .attr("title", p[i].label + " | " + p[i].x+ " | " + p[i].y)
                .attr("cx", xScale1(p[i].x)+(i*17)) 
                .attr("cy", yScale1(p[i].y)+18)
                .attr("r", 8)
                .style("fill", color(blocks))
                .style("opacity", 1);
             i++
             }
        });
    }

    for (var i=0; i<uniqueTeams.length;i++){
        svg.append("svg:image")
        .attr("xlink:href", imgsLinks[i])
        .attr("x", xScale1(uniqueTeams[i])+30)
        .attr("y", paddingtop/3)
        .attr("width", "60")
        .attr("height", "40");
    }
   // JQuery for displaying the information of each player when mouseover. 4/26 edit

    $(".tooltip").attr("data-toggle", "tooltip"); // adding data-toggle attr to each circle
    // select the all element with data-toggle = "tooltip" to create tooltip
    $('[data-toggle="tooltip"]').tooltip({
        'container': 'body',
        'placement': 'top'
    });   

});
/* ---------------------------------------------- VISUALIZATION 4 --------------------------------------------- */
/* ----------------------------------------------                 --------------------------------------------- */
/* ----------------------------------------------                 --------------------------------------------- */
/* ------------------------------------------------------------------------------------------------------------ */
 /*

                                    ################ FORMATS ##################
                                    -------------------------------------------
 */

var     formatAsPercentage = d3.format(".2%"),
        formatAsInteger = d3.format(","),
        fsec = d3.time.format("%S s"),
        fmin = d3.time.format("%M m"),
        fhou = d3.time.format("%H h"),
        fwee = d3.time.format("%a"),
        fdat = d3.time.format("%d d"),
        fmon = d3.time.format("%b")
        ;

/*
                                ############# PIE CHART ###################
                                -------------------------------------------
*/


function dsPieChart(){

     var dataset = [
          {category: "Players", measure: 1},
          {category: "Stadiums", measure: 1},
          {category: "U20 Cups", measure: 1},
          ];
          

     var width = 400,
           height = 400,
           outerRadius = Math.min(width, height) / 2,
           innerRadius = outerRadius * .999,   
           // for animation
           innerRadiusFinal = outerRadius * .5,
           innerRadiusFinal3 = outerRadius* .45,
           color = d3.scale.category20() ;   //builtin range of colors
           
          
     var vis = d3.select("#pieChart")
         .append("svg:svg")     //create the SVG element inside the <body>
         .data([dataset]) //associate our data with the document
         .attr("width", width) //set the width and height of our visualization (these will be attributes of the <svg> tag
         .attr("height", height)
         .append("svg:g")  //make a group to hold our pie chart
         .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")") ;  //move the center of the pie chart from 0, 0 to radius, radius     
                
     var arc = d3.svg.arc()  //this will create <path> elements for us using arc data
            .outerRadius(outerRadius).innerRadius(innerRadius);
   
            // for animation
     var arcFinal = d3.svg.arc().innerRadius(innerRadiusFinal).outerRadius(outerRadius);
     var arcFinal3 = d3.svg.arc().innerRadius(innerRadiusFinal3).outerRadius(outerRadius);

     var pie = d3.layout.pie()  //this will create arc data for us given a list of values
        .value(function(d) { return d.measure; }); //we must tell it out to access the value of each element in our data array

     var arcs = vis.selectAll("g.slice")//this selects all <g> elements with class slice (there aren't any yet)
        .data(pie)   //associate the generated pie data (an array of arcs, each having startAngle, endAngle and value properties) 
        .enter()  //this will create <g> elements for every "extra" data element that should be associated with a selection. The result is creating a <g> for every object in the data array
        .append("svg:g")  //create a group to hold each slice (we will have a <path> and a <text> element associated with each slice)
        .attr("class", "slice")//allow us to style things in the slices (like text)
        .on("mouseover", mouseover)
        .on("mouseout", mouseout)
        .on("click", up)
        ;
                    
        arcs.append("svg:path")
            .attr("fill", function(d, i) { return color(i); } ) //set the color for each slice to be chosen from the color function defined above
            .attr("d", arc)     //this creates the actual SVG path using the associated data (pie) with the arc drawing function
            .append("svg:title") //mouseover title showing the figures
            .text(function(d) { return d.data.category + ": " + formatAsPercentage(d.data.measure); });            

        d3.selectAll("g.slice").selectAll("path").transition()
                .duration(750)
                .delay(10)
                .attr("d", arcFinal);
    
      // Add a label to the larger arcs, translated to the arc centroid and rotated.
      // source: http://bl.ocks.org/1305337#index.html
      arcs.filter(function(d) { return d.endAngle - d.startAngle > .2; })
          .append("svg:text")
          .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .attr("transform", function(d) { return "translate(" + arcFinal.centroid(d) + ")rotate(" + angle(d) + ")"; })
          .text(function(d) { return d.data.category; });
       
       // Computes the label angle of an arc, converting from radians to degrees.
        function angle(d) {
            var a = (d.startAngle + d.endAngle) * 90 / Math.PI - 90;
            return a > 90 ? a - 180 : a;
        }
                
        // Pie chart center text            
     vis.append("svg:text")
          .attr("dy", ".35em")
          .attr("text-anchor", "middle")
          .text("Football Culture")
          .attr("class","title")
          ;         
    
    function mouseover() {
      d3.select(this).select("path").transition()
        .duration(750)
        .attr("d", arcFinal3);               
    }
    
    function mouseout() {
      d3.select(this).select("path").transition()
          .duration(750)  
          .attr("d", arcFinal);                    
    }

    function up(d, i) {
                /* update bar chart when user selects piece of the pie chart */
                updateBarChart(d.data.category, color(i));           
    }
}

dsPieChart();

/*
############# BAR CHART ###################
-------------------------------------------
*/


var datasetBarChart = [
{ group: "Population", category: "Brazil", measure: 174500000 },
{ group: "Population", category: "Germany", measure: 82470000 },
{ group: "Population", category: "Italy", measure: 56940000 },
{ group: "Population", category: "Argentina", measure: 38650000},
{ group: "Population", category: "Spain", measure: 40500000 },
{ group: "Population", category: "France", measure: 60910000 },
{ group: "Population", category: "England", measure: 53012456 },
    
{ group: "Players", category: "Brazil", measure: 0.0756 }, 
{ group: "Players", category: "Germany", measure: 0.1978  }, 
{ group: "Players", category: "Italy", measure: 0.0875  }, 
{ group: "Players", category: "Argentina", measure: 0.0688}, 
{ group: "Players", category: "Spain", measure: 0.07 },
{ group: "Players", category: "France", measure: 0.0688}, 
{ group: "Players", category: "England", measure: 0.0785 },  
    
{ group: "Stadiums", category: "Brazil", measure: 0.0096 }, 
{ group: "Stadiums", category: "Germany", measure: 0.0142  }, 
{ group: "Stadiums", category: "Italy", measure: 0.0127  },
{ group: "Stadiums", category: "Argentina", measure: 0.0236}, 
{ group: "Stadiums", category: "Spain", measure: 0.022 },
{ group: "Stadiums", category: "France", measure: 0.0106}, 
{ group: "Stadiums", category: "England", measure: 0.0217 },  
    
    
{ group: "U20 Cups", category: "Brazil", measure: 0.25 }, 
{ group: "U20 Cups", category: "Germany", measure: 0.05  }, 
{ group: "U20 Cups", category: "Italy", measure: 0  }, 
{ group: "U20 Cups", category: "Argentina", measure: 0.3}, 
{ group: "U20 Cups", category: "Spain", measure: 0.05 },
{ group: "U20 Cups", category: "France", measure: 0.05}, 
{ group: "U20 Cups", category: "England", measure: 0 },  
]
;

// set initial group value
var group = "Population";

function datasetBarChosen(group) {
    var ds = [];
    for (x in datasetBarChart) {
         if(datasetBarChart[x].group==group){
            ds.push(datasetBarChart[x]);
         } 
        }
    return ds;
}


function dsBarChartBasics() {
        var margin = {top: 30, right: 5, bottom: 20, left: 50},
        width = 550 - margin.left - margin.right,
        height = 300 - margin.top - margin.bottom,
        colorBar = d3.scale.category20(),
        barPadding = 2
        ;
        
        return {
            margin : margin, 
            width : width, 
            height : height, 
            colorBar : colorBar, 
            barPadding : barPadding
        }           
        ;
}

function dsBarChart() {

    var firstDatasetBarChart = datasetBarChosen(group);             
    
    var basics = dsBarChartBasics();
    
    var margin = basics.margin,
        width = basics.width,
        height = basics.height,
        colorBar = basics.colorBar,
        barPadding = basics.barPadding
        ;
                    
    var xScale = d3.scale.linear()
                        .domain([0, firstDatasetBarChart.length])
                        .range([0, width])
                        ;
                        
    // Create linear y scale 
    // Purpose: No matter what the data is, the bar should fit into the svg area; bars should not
    // get higher than the svg height. Hence incoming data needs to be scaled to fit into the svg area.  
    var yScale = d3.scale.linear()
            // use the max funtion to derive end point of the domain (max value of the dataset)
            // do not use the min value of the dataset as min of the domain as otherwise you will not see the first bar
           .domain([0, d3.max(firstDatasetBarChart, function(d) { return d.measure; })])
           // As coordinates are always defined from the top left corner, the y position of the bar
           // is the svg height minus the data value. So you basically draw the bar starting from the top. 
           // To have the y position calculated by the range function
           .range([height, 0])
           ;
    
    //Create SVG element
    
    var svg = d3.select("#barChart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .attr("id","barChartPlot");    
    
    var plot = svg
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                    
    plot.selectAll("rect")
           .data(firstDatasetBarChart)
           .enter()
           .append("rect")
           .attr("x", function(d, i) {
                return xScale(i);
            })
           .attr("width", width / firstDatasetBarChart.length - barPadding)   
           .attr("y", function(d) {
                return yScale(d.measure);
            })  
            .attr("height", function(d) {
                return height-yScale(d.measure);
            })
            .attr("fill", "lightgrey");
        
    // Add y labels to plot 
    plot.selectAll("text")
    .data(firstDatasetBarChart)
    .enter()
    .append("text")
    .text(function(d) {
        return formatAsInteger(d3.round(d.measure)); // added , to larger population number
            //return d.measure;
    })
    .attr("text-anchor", "middle")
    // Set x position to the left edge of each bar plus half the bar width
    .attr("x", function(d, i) {
            return (i * (width / firstDatasetBarChart.length)) + ((width / firstDatasetBarChart.length - barPadding) / 2);
    })
    .attr("y", function(d) {
            return yScale(d.measure) + 14;
    })
    .attr("class", "yAxis") ;
    
    // Add x labels to chart    
    
    var xLabels = svg
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + (margin.top + height)  + ")");
    
    xLabels.selectAll("text.xAxis")
          .data(firstDatasetBarChart)
          .enter()
          .append("text")
          .text(function(d) { return d.category;})
          .attr("text-anchor", "middle")
            // Set x position to the left edge of each bar plus half the bar width
         .attr("x", function(d, i) {
              return (i * (width / firstDatasetBarChart.length)) + ((width / firstDatasetBarChart.length - barPadding) / 2);
                           })
          .attr("y", 15)
          .attr("class", "xAxis") ;         
     
    // Title
    svg.append("text")
        .attr("x", (width + margin.left + margin.right)/2)
        .attr("y", 15)
        .attr("class","title")              
        .attr("text-anchor", "middle")
        .text("Population");
}

dsBarChart();

 /* ** UPDATE CHART ** */
 
/* updates bar chart on request */

function updateBarChart(group, colorChosen) {
    
        var currentDatasetBarChart = datasetBarChosen(group);
        
        var basics = dsBarChartBasics();
    
        var margin = basics.margin,
            width = basics.width,
            height = basics.height,
            colorBar = basics.colorBar,
            barPadding = basics.barPadding
            ;
        
        var xScale = d3.scale.linear()
            .domain([0, currentDatasetBarChart.length])
            .range([0, width]) ;
            
        var yScale = d3.scale.linear()
          .domain([0, d3.max(currentDatasetBarChart, function(d) { return d.measure; })])
          .range([height,0]) ;
          
       var svg = d3.select("#barChart svg");
          
       var plot = d3.select("#barChartPlot")
        .datum(currentDatasetBarChart) ;
    
            /* Note that here we only have to select the elements - no more appending! */
        plot.selectAll("rect")
            .data(currentDatasetBarChart)
            .transition()
            .duration(750)
            .attr("x", function(d, i) {
                return xScale(i);
            })
            .attr("width", width / currentDatasetBarChart.length - barPadding)   
            .attr("y", function(d) {
                return yScale(d.measure);
            })  
            .attr("height", function(d) {
                return height-yScale(d.measure);
            })
            .attr("fill", colorChosen)  ;
        
        var formatPercent = function(x) { return formatAsPercentage(x).replace(/\.0+%$/, "%"); };
        
        plot.selectAll("text.yAxis") // target the text element(s) which has a yAxis class defined
            .data(currentDatasetBarChart)
            .transition()
            .duration(750)
            .attr("text-anchor", "middle")
            .attr("x", function(d, i) {
                return (i * (width / currentDatasetBarChart.length)) + ((width / currentDatasetBarChart.length - barPadding) / 2);
           })
           .attr("y", function(d) {
                return yScale(d.measure) + 14;
           })
           .text(function(d) {
                //return formatAsInteger(d3.round(d.measure)); // added , to larger population number
                  return formatPercent(d.measure) ;
                 
           })
           .attr("class", "yAxis")  ;
        
        
        var arr = ["General Football Players vs Population in Each Country", 
                   "Mega Stadium Capacity vs Population in Each Country", 
                    "U20 World Cups Each Country Earned vs Total U20 Cups"];
        
        var map = new Object();
        map["Players"] = arr[0];
        map["Stadiums"] = arr[1];
        map ["U20 Cups"] = arr[2];
        function get (k){
            return map[k];
        }
        
        svg.selectAll("text.title") // target the text element(s) which has a title class defined
            .attr("x", (width + margin.left + margin.right)/2)
            .attr("y", 15)
            .attr("class","title")
            .attr("text-anchor", "middle")
            .text(get(group)); ;
}


</script>
</body>
</html>
